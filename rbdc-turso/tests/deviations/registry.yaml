# Deviation Registry — rbdc-turso
#
# Canonical record of all known behavioral differences between the Turso
# adapter and common rbdc adapter conventions. Each entry has a corresponding
# compile-time constant in registry.rs and a dedicated test in deviations.rs.
#
# Approval statuses:
#   approved        — Intentional difference, accepted per governance.
#   proposed        — Difference exists, pending governance decision. Blocks release.
#   rejected        — Adapter must be fixed to match expected behavior.
#   not_a_deviation — Investigation confirmed parity behavior.

deviations:
  - id: DEV-001
    title: "column_type reports runtime value type, not declared schema type"
    linked_scenarios:
      - PAR-008
      - PAR-014
    status: approved
    summary: >
      MetaData::column_type() returns runtime value type names (INTEGER, REAL,
      TEXT, BLOB, NULL) derived from libsql::ValueType, not declared schema
      types. Custom type aliases (BOOLEAN, DATETIME) are not exposed — only the
      5 base storage classes.
    user_impact: >
      Code matching specific type aliases (BOOLEAN, DATETIME) sees only base
      storage classes (INTEGER, TEXT, etc.). For empty result sets, type info is
      unavailable.
    rationale: >
      The rbdc MetaData::column_type() trait contract does not specify whether
      declared or runtime types are returned. Turso's native async API exposes
      value-level types via ValueType enum, not schema-level type declarations.
      This is inherent to the native API design.

  - id: DEV-002
    title: "Boolean values round-trip as integers"
    linked_scenarios:
      - PAR-007
    status: not_a_deviation
    summary: >
      Value::Bool(true) is encoded as INTEGER 1, read back as Value::I64(1).
      This matches the standard adapter convention.
    user_impact: "None. Both Turso and other adapters behave identically."
    rationale: "Investigation confirmed parity. Documented for awareness only."

  - id: DEV-003
    title: "JSON text decoding heuristic"
    linked_scenarios:
      - PAR-006
    status: not_a_deviation
    summary: >
      Text values matching is_json_string() (starts with {/[ or equals 'null')
      are attempted as JSON parse. If parse fails, returned as String.
    user_impact: "None. Heuristic matches standard adapter behavior."
    rationale: "Investigation confirmed parity. Same heuristic implemented."

  - id: DEV-004
    title: "last_insert_id stored as Value::U64"
    linked_scenarios:
      - PAR-010
      - PAR-011
    status: proposed
    summary: >
      ExecResult.last_insert_id is Value::U64 (cast from i64 rowid). Other
      adapters may use Value::I64 or Value::U64 — the ExecResult type specifies
      Value, not a concrete integer type.
    user_impact: >
      Code that pattern-matches specifically on Value::I64 for last_insert_id
      will not match. Should use numeric extraction methods instead.
    rationale: >
      Requires governance decision. The rowid is conceptually unsigned (always
      positive), but i64 is the underlying storage type. Standardizing across
      adapters would be ideal but is outside this crate's scope.
